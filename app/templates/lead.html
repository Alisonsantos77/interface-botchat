{% extends "base.html" %}
{% block title %}Leads{% endblock %}
{% block content %}
<div class="grid md:grid-cols-3 gap-6">
	<div>
		<h4 class="font-bold mb-2">Leads</h4>
		<ul class="bg-white rounded shadow divide-y">
			{% for lead in leads %}
			<li
				class="{% if selected_lead and lead.id == selected_lead.id %}bg-blue-50{% endif %} flex items-center justify-between px-4 py-2">
				<a href="{{ url_for('get_leads_ia', ia_id=lead.ia_id, lead_id=lead.id) }}"
					class="block w-full {% if selected_lead and lead.id == selected_lead.id %}text-blue-700 font-bold{% endif %}">
					{{ lead.name or lead.phone }}
				</a>
				<form action="{{ url_for('delete_lead', id_lead=lead.id) }}" method="post"
					onsubmit="return confirm('Excluir este lead?');">
					<button type="submit" class="text-red-600 hover:underline text-xs">âœ•</button>
				</form>
			</li>
			{% endfor %}
		</ul>
	</div>
	<div class="md:col-span-2">
		{% if selected_lead %}
		<h4 class="font-bold mb-2">Chat com {{ selected_lead.name or selected_lead.phone }}</h4>
		<div class="bg-white rounded shadow p-4 mb-4 max-h-96 overflow-y-auto">
			{% for msg in selected_lead.message %}
			<div class="mb-2">
				<span class="font-semibold">{{ msg.role|capitalize }}:</span>
				<span>{{ msg.content }}</span>
			</div>
			{% endfor %}
		</div>
		{% if selected_lead.resume %}
		<div class="bg-blue-100 text-blue-800 rounded p-3">
			<strong>Resumo:</strong> {{ selected_lead.resume }}
		</div>
		{% endif %}
		{% else %}
		<div class="bg-gray-200 text-gray-700 p-4 rounded">Selecione um lead no painel lateral para visualizar o chat.
		</div>
		{% endif %}
	</div>
</div>
{% endblock %}